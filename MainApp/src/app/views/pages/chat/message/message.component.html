<div class="chat-content" *ngIf="selectedUser.userName != ''">
  <div class="chat-header border-bottom pb-2">
    <div class="d-flex justify-content-between">
      <div class="d-flex align-items-center">
        <i (click)="false" class="feather icon-corner-up-left icon-md mr-2 ml-n2 text-muted d-lg-none"></i>
        <figure class="mb-0 mr-2">
          <img [src]="selectedUserImagePath" class="img-sm rounded-circle">
          <div class="status online" *ngIf="selectedUser.status === 1"></div>
          <div class="status pause" *ngIf="selectedUser.status === 2 || selectedUser.status === 3"></div>
          <div class="status away" *ngIf="selectedUser.status === 4|| selectedUser.status === 5"></div>
          <div class="status offline" *ngIf="selectedUser.status === 6"></div>
        </figure>
        <div>
          <p>{{selectedUser.firstName}} {{selectedUser.lastName}}</p>
          <p class="text-muted tx-13">{{selectedUser.userName}}</p>
        </div>
      </div>
      <div class="d-flex align-items-center mr-n1">        
        <!-- <a (click)="scrollMe.scrollTop = 0">
          <i class="feather icon-arrow-up-circle icon-md text-muted mr-3" ngbTooltip="Go To Start"></i>
        </a>
        <a (click)="scrollMe.scrollTop = scrollMe.scrollHeight">
          <i class="feather icon-arrow-down-circle icon-md text-muted mr-3" ngbTooltip="Go To End"></i>
        </a>        -->
        <a (click)="reloadChat()">
          <i class="feather icon-refresh-ccw icon-md text-muted mr-3" ngbTooltip="Reload Chat"></i>
        </a>                  
        <!-- <a href="" (click)="false">
          <i class="feather icon-video icon-md text-muted mr-3" ngbTooltip="Start video call"></i>
        </a>
        <a href="" (click)="false">
          <i class="feather icon-phone-call icon-md text-muted mr-0 mr-sm-3" ngbTooltip="Start voice call"></i>
        </a>
        <a href="" (click)="false" class="d-none d-sm-block">
          <i class="feather icon-user-plus icon-md text-muted" ngbTooltip="Add to contacts"></i>
        </a> -->
      </div>
    </div>
  </div>
  <div class="chat-body" [perfectScrollbar] #scrollMe>
    <ul class="messages" *ngFor="let message of chatsToLoad; let i = index">
      <li class="text-center" *ngIf="i == 0 || (message.sentAt | date : 'mediumDate') !== (chatsToLoad[i-1].sentAt | date : 'mediumDate')">
        <p class="p-1 d-inline-block text-muted rounded" style="font-size: 0.7rem; background-color: rgba(194, 202, 209, 0.897);">
          <span>{{message.sentAt | date : 'mediumDate'}}</span>
        </p>
      </li>
      <li class="message-item" [class.friend]="!message.sent" [class.me]="message.sent" (dblclick)="replyTo(message.id)" [id]="message.id">
        <div class="content">
            <div class="bubble">
              <a (click)="false">
                <span *ngIf="message.replyToChat != -1">
                    {{message.replyToContent}}
                    <hr>
                </span>
              </a>
              <p *ngIf="message.type === 'text'">{{message.content}}</p>
              <img [src]="getSrc(message.content)" *ngIf="checkFormat(message.type)==='image'" height="200">
              <video [src]="getSrc(message.content)" *ngIf="checkFormat(message.type)==='video'" height="200" controls></video>
              <audio [src]="getSrc(message.content)" *ngIf="checkFormat(message.type)==='audio'" controls></audio>    
            </div>
            <span *ngIf="message.isRead == 0 && message.sent"><i class="feather icon-eye-off"></i></span>
            <span *ngIf="message.isRead == 1 && message.sent"><i class="feather icon-eye"></i></span>
            <span>{{message.sentAt | date:'short'}}</span>
          </div>
    </li>
    </ul>
  </div>
  <app-reply-message [message]="replytoMessage" *ngIf="replytoMessage != null" (cancelReplying)="resetReply()"></app-reply-message>
  <emoji-mart *ngIf="isEmojiPickerVisible" emoji="point_up" set="apple" (emojiClick)="addEmoji($event)" [style]="{ position: 'absolute', bottom: '3rem'}" [showPreview]="false"></emoji-mart>

  <div class="chat-footer d-flex">
    <div class="d-none d-md-block">
      <button type="button" (click)="isEmojiPickerVisible = !isEmojiPickerVisible " class="btn border btn-icon rounded-circle mr-2" ngbTooltip="Emoji">
        <i class="feather icon-sun text-muted"></i>
      </button>
    </div>
    
    <div class="d-none d-md-block">
      <button type="button" (click)="file.click()" class="btn border btn-icon rounded-circle mr-2" ngbTooltip="Attatch files" #attachButton>
        <i class="feather icon-paperclip text-muted"></i>
      </button>
      <input type="file" accept="image/png, image/jpeg, video/mp4, video/mpeg, image/gif, video/webm, audio/aac, audio/mpeg, audio/wav, audio/webm" #file (change)="uploadedFile($event)" hidden>
    </div>
    <div class="d-none d-md-block">
      <button type="button" class="btn border btn-icon rounded-circle mr-2" ngbTooltip="Record you voice">
        <i class="feather icon-mic text-muted"></i>
      </button>
    </div>
    <form class="search-form flex-grow mr-2">
      <div class="input-group">
        <input type="text" class="form-control rounded-pill" id="chatForm" #chatForm placeholder="Type a message" (keydown.enter)="sendChat($event)">
      </div>
    </form>
    <div>
      <button type="button" class="btn btn-primary btn-icon rounded-circle" (click)="sendChat($event)">
        <i class="feather icon-send"></i>
      </button>
    </div>
  </div>
</div>
<div class="container text-center" *ngIf="selectedUser.userName == ''">
    <div class="chat-placeholder">
      <div class="chat-placeholder-icon">
        <i class="far fa-comment-dots"></i>
      </div>
      <div class="chat-placeholder-text">
        <img src="../../../../../assets/images/ChatPlaceHolder.gif" alt="">
        <h3>Welcome to Chat App!</h3>
        <p>Please select a user to start chatting.</p>
      </div>
  </div>
</div>




<ng-template #basicModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="exampleModalLabel">Name Of The File : - {{file.name}}</h5>
    <button type="button" (click)="modal.close()" aria-label="Close">
      <i class="feather icon-x text-muted"></i>
    </button>
  </div>
  <div class="modal-body align-items-center">
    <img [src]="url" *ngIf="format==='image' && url" height="200"> <br/>
    <video [src]="url" *ngIf="format==='video' && url" height="200" controls></video> <br/>
    <audio [src]="url" *ngIf="format==='audio' && url" controls></audio> <br/>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close();">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="sendFile(); modal.close();">Send File</button>
  </div>
</ng-template>

<!-- <ng-content></ng-content>
<li class="message-item" [class.friend]="!me" [class.me]="me" (dblclick)="replyTo(message.id)" [id]="message.id">
    <div class="content">
      <div class="message">
        <div class="bubble">
          <a (click)="false">
            <span *ngIf="message.replyToChat != -1">
                {{message.replyToContent}}
                <hr>
            </span>
          </a>
          <p *ngIf="message.type === 'text'">{{message.content}}</p>
          <img [src]="url" *ngIf="format==='image' && url" height="200">
          <video [src]="url" *ngIf="format==='video' && url" height="200" controls></video>
          <audio [src]="url" *ngIf="format==='audio' && url" controls></audio>    
        </div>
        <span *ngIf="message.isRead == 0 && me"><i class="feather icon-eye-off"></i></span>
        <span *ngIf="message.isRead == 1 && me"><i class="feather icon-eye"></i></span>
        <span>{{message.sentAt | date:'short'}}</span>
      </div>
    </div>
</li> -->


<!-- 
  backToChatList() removed from the navbar
 -->